<div class="app-container" [class.player-visible]="hasCurrentTrack()">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">

      <!-- Brand -->
      <a class="navbar-brand" routerLink="/library">
        <i class="bi bi-music-note-beamed me-2"></i>
        <strong>MusicStream</strong>
        <span class="badge bg-danger ms-2">PRO</span>
      </a>

      <!-- Toggle pour mobile -->
      <button class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Contenu de la navbar -->
      <div class="collapse navbar-collapse" id="navbarContent">

        <!-- Navigation principale -->
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link"
               routerLink="/library"
               routerLinkActive="active"
               [routerLinkActiveOptions]="{exact: false}">
              <i class="bi bi-collection-play me-1"></i>
              Bibliothèque
            </a>
          </li>

          <!-- Menu déroulant pour les stats -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle"
               href="#"
               role="button"
               data-bs-toggle="dropdown">
              <i class="bi bi-bar-chart me-1"></i>
              Statistiques
            </a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="#">
                <i class="bi bi-graph-up me-2"></i>
                Vue d'ensemble
              </a>
              <a class="dropdown-item" href="#">
                <i class="bi bi-calendar3 me-2"></i>
                Historique
              </a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">
                <i class="bi bi-download me-2"></i>
                Exporter les stats
              </a>
            </div>
          </li>
        </ul>

        <!-- Actions utilisateur -->
        <div class="navbar-actions">

          <!-- Recherche globale -->
          <div class="nav-search me-3">
            <div class="input-group input-group-sm">
              <span class="input-group-text bg-dark border-dark">
                <i class="bi bi-search"></i>
              </span>
              <input type="text"
                     class="form-control bg-dark border-dark text-white"
                     placeholder="Recherche globale..."
                     style="min-width: 200px;">
            </div>
          </div>

          <!-- Notifications -->
          <div class="dropdown me-3">
            <button class="btn btn-link text-white dropdown-toggle"
                    data-bs-toggle="dropdown">
              <i class="bi bi-bell"></i>
              <span class="badge bg-danger rounded-pill">3</span>
            </button>
            <div class="dropdown-menu dropdown-menu-end">
              <h6 class="dropdown-header">Notifications</h6>
              <a class="dropdown-item" href="#">
                <div class="d-flex w-100 justify-content-between">
                  <small class="text-muted">Il y a 5 min</small>
                </div>
                <p class="mb-1">Nouvelle piste ajoutée</p>
              </a>
              <a class="dropdown-item" href="#">
                <div class="d-flex w-100 justify-content-between">
                  <small class="text-muted">Il y a 1 heure</small>
                </div>
                <p class="mb-1">Mise à jour disponible</p>
              </a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item text-center" href="#">
                Voir toutes
              </a>
            </div>
          </div>

          <!-- Utilisateur -->
          <div class="dropdown">
            <button class="btn btn-link text-white dropdown-toggle d-flex align-items-center"
                    data-bs-toggle="dropdown">
              <div class="user-avatar me-2">
                <i class="bi bi-person-circle"></i>
              </div>
              <span>Utilisateur</span>
            </button>
            <div class="dropdown-menu dropdown-menu-end">
              <h6 class="dropdown-header">Compte</h6>
              <a class="dropdown-item" href="#">
                <i class="bi bi-person me-2"></i>
                Profil
              </a>
              <a class="dropdown-item" href="#">
                <i class="bi bi-gear me-2"></i>
                Paramètres
              </a>
              <div class="dropdown-divider"></div>
              <h6 class="dropdown-header">Application</h6>
              <a class="dropdown-item" (click)="refreshLibrary()">
                <i class="bi bi-arrow-clockwise me-2"></i>
                Rafraîchir
              </a>
              <a class="dropdown-item" (click)="exportData()">
                <i class="bi bi-download me-2"></i>
                Sauvegarder
              </a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item text-danger" href="#">
                <i class="bi bi-box-arrow-right me-2"></i>
                Déconnexion
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Contenu principal -->
  <main class="app-main">

    <!-- Barre de chargement -->
    <div *ngIf="isLoading()" class="app-loading-bar">
      <div class="loading-progress"></div>
    </div>

    <!-- Contenu du router -->
    <div class="router-content">
      <router-outlet></router-outlet>
    </div>

    <!-- Bouton retour en haut -->
    <button class="btn-scroll-top"
            (click)="scrollToTop()"
            *ngIf="currentRoute() !== '/'">
      <i class="bi bi-chevron-up"></i>
    </button>
  </main>

  <!-- Lecteur audio -->
  <div *ngIf="hasCurrentTrack()" class="app-player" [class.minimized]="!showPlayer()">
    <app-audio-player></app-audio-player>

    <!-- Bouton pour afficher/masquer -->
    <button class="player-toggle" (click)="togglePlayer()">
      <i class="bi" [class.bi-chevron-down]="showPlayer()" [class.bi-chevron-up]="!showPlayer()"></i>
    </button>
  </div>

  <!-- Footer -->
  <footer class="app-footer">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-md-6">
          <p class="mb-0 small text-muted">
            &copy; 2024 MusicStream. Tous droits réservés.
            <span class="ms-2">
              <i class="bi bi-database me-1"></i>
              {{ storageUsage() }}% utilisé
            </span>
          </p>
        </div>
        <div class="col-md-6 text-end">
          <div class="footer-links">
            <a href="#" class="text-muted small me-3">À propos</a>
            <a href="#" class="text-muted small me-3">Aide</a>
            <a href="#" class="text-muted small me-3">Conditions</a>
            <a href="#" class="text-muted small">Confidentialité</a>
          </div>
        </div>
      </div>
    </div>
  </footer>
</div>
